# 图形绘制技术Project (Option 1)

*151220129* 吴政亿

*151220114* 王宇鑫

## 项目背景

### 三维图形绘制的基本概念

**三维计算机图形**（英语：*3D computer graphics*）是[电子计算机](https://zh.wikipedia.org/wiki/電子計算機)和特殊三维[软件](https://zh.wikipedia.org/wiki/软件)帮助下创造的作品。一般来讲，该术语可指代创造这些图形的过程，或者三维计算机图形技术的研究领域，及其相关技术。

三维计算机图形和[二维计算机图形](https://zh.wikipedia.org/wiki/二维计算机图形)的不同之处在于计算机内存储存了几何数据的三维表示，用于计算和绘制最终的二维图像。

创建三维计算机图形的过程可以顺序分为三个基本阶段：

- [建模](https://zh.wikipedia.org/wiki/建模)
- 场景布局和动画
- 绘制

建模过程可能也包括编辑物体表面或材料性质（例如，颜色，荧光度，漫射和镜面反射分量—经常被叫做粗糙度和光洁度，反射特性，透明度或不透明度，或者折射指数），增加纹理，凹凸映射和其它特征。

把物体的表示（例如[球面](https://zh.wikipedia.org/wiki/球面)的中[点](https://zh.wikipedia.org/wiki/点)[坐标](https://zh.wikipedia.org/wiki/坐标)和它的[表面](https://zh.wikipedia.org/wiki/表面)上的一个点所表示的球面），转换到一个（球面的）多边形表示的过程，称为*剖分（tesselation）*。该步骤用于基于多边形的绘制，其中对象从象球面，[圆锥面](https://zh.wikipedia.org/w/index.php?title=圆锥面&action=edit&redlink=1)等等这样的抽象的表示（“体素”），分解成为所谓“网格”，它是互相连接的三角形的网络。

三角网格（而不是[正方形](https://zh.wikipedia.org/wiki/正方形)等形状）比较流行，因为它们易于采用[扫描线绘制](https://zh.wikipedia.org/w/index.php?title=扫描线绘制&action=edit&redlink=1)进行绘制。

多边形表示不是所有绘制技术都必须的，而在这些情况下，从抽象表示到绘制出的场景的转换不包括剖分步骤。

在渲染成[图象](https://zh.wikipedia.org/wiki/图象)之前，模型必须放置在一个[场景](https://zh.wikipedia.org/w/index.php?title=场景&action=edit&redlink=1)中。这定义了模型的位置和大小。

场景设置涉及安排一个场景内的虚拟物体，灯光，摄像机和其他实体，它将被用于制作一幅静态画面或一段动画。

照明是场景布置中一个重要的方面。就象在实际场景布置的时候一样，光照是最终作品的审美和视觉质量的关键因素之一。因而，它是一项很难掌握的艺术。光照因素可以对一个场景的氛围和情绪反映作出重大贡献，这是为摄影师和舞台照明师所熟悉的事实。

[渲染](https://zh.wikipedia.org/wiki/渲染)是从准备的场景创建实际的二维景象或动画的最后阶段。这可以和现实世界中在布景完成后的照相或摄制场景的过程相比。

用于诸如游戏或模拟程序这样的交互式媒体的渲染需要实时计算和显示，速度约为20到120帧每秒。非交互式媒体（譬如录象或电影），渲染的慢得多。非实时渲染使得有限的计算能力得以放大以获得高质量的画面。复杂场景的单帧的渲染速度可能从几秒到一个小时或者更多。渲染完成的帧存贮在硬盘，然后可能转录到其它媒介，例如电影胶卷或者光盘。然后这些帧以高帧率播放，通常为24，25，或30帧每秒，以达成运动的假象。

最后的作品经常会需要达到真实感图形质量，要达到这个目的，很多不同和专门的渲染技术被发展出来。这些技术的范围包括相当非真实感的[线框模型](https://zh.wikipedia.org/wiki/线框模型)渲染技术，到基于多边形的渲染，到更高级的技术，例如：[扫描线渲染](https://zh.wikipedia.org/wiki/扫描线渲染)、[光线跟踪](https://zh.wikipedia.org/wiki/光线跟踪)或者[辐射着色](https://zh.wikipedia.org/wiki/辐射着色)。

渲染软件可以模拟例如[镜头光晕](https://zh.wikipedia.org/w/index.php?title=镜头光晕&action=edit&redlink=1)、[景深](https://zh.wikipedia.org/wiki/景深)或者[运动模糊](https://zh.wikipedia.org/wiki/运动模糊)这样的视觉效果。这些技术试图模拟镜头和人眼的光学特性所造成的视觉现象。这些技术可以增加场景的真实程度，虽然该效果可能只是镜头的人造模拟现象。

为模拟其他自然发生的效应的各种技术被发展出来，例如光和不同形式的物质的相互作用。这些技术的例子包括[粒子系统](https://zh.wikipedia.org/wiki/粒子系统)（它可以模拟雨，烟，或者火），[体采样](https://zh.wikipedia.org/w/index.php?title=体采样&action=edit&redlink=1)（用于模拟雾，尘或者其它空间大气效果），[焦散效果](https://zh.wikipedia.org/w/index.php?title=焦散效果&action=edit&redlink=1)（用于模拟光被不均匀折射性质的表面所聚焦的现象，例如游泳池底部的光的涟漪），还有[次表面散射](https://zh.wikipedia.org/wiki/次表面散射)（subsurface scattering，用于模拟光在人的皮肤这样的实体对象内部反射的现象）。

现代三维计算机图形严重的依赖于一个简化的反射模型称为*Phong反射模型*，它和[Phong明暗图](https://zh.wikipedia.org/w/index.php?title=Phong明暗图&action=edit&redlink=1)是完全不同的主题，不能混淆二者。

### 几何模型

#### 球（Shpere）

<!--插图-->

| 变量名           | 意义                                                         |
| ---------------- | ------------------------------------------------------------ |
| glm::vec3 center | 球的中心点在世界坐标系的三维坐标                             |
| float radius     | 球的半径                                                     |
| int m            | 在z轴上的切片步数，越大则球在z轴越光滑，但是会增加绘制复杂度。 |
| int n            | 在x轴和y轴上的切片步数，越大则球在x轴和y轴越光滑，但是会增加绘制复杂度。 |



| 函数名    | 功能                                                         |
| --------- | ------------------------------------------------------------ |
| draw      | 根据参数center、radius、m、n绘制球体                         |
| intersect | 根据传入参数光线与球求交点，返回交点的位置                   |
| apply     | 根据传入的四维矩阵，对球进行旋转、平移、放缩变换             |
| normal    | 根据传入的点的坐标（已知点在物体表面），返回该点所在的法向量 |
| inside    | 根据传入的点的坐标，判断点是否在球内                         |

#### 立方体（Cube）



#### 线（Line）



### 光源模型

### 相机模型

#### 小孔成像

<!--插图-->

#### 薄透镜

<!--插图-->

### 材质模型

### 对比分析四种常用光照算法

#### 光线投射

<!--插图-->

#### 光线跟踪

<!--插图-->

#### 分布式光线跟踪

<!--插图-->

#### 路径跟踪

<!--插图-->
<!--我们做的是这个-->

### 实验目的

探究以物理为基础的真实绘制---主要是光线的能量追踪，所带来的优势和劣势。

## 系统分析与设计

### 模块分解图

类图：

![img](class_diagram.jpg)

### 光照算法

> 算法流程图/伪代码

<!--主要就是renderer的render函数的流程-->

## 系统实现

### 开发与运行环境

1. QT5.12.2
1. opengl
1. c++17
1. win/mac

### 重要模块/算法实现细节

#### renderer

渲染主要流程。

<!--实现和考虑之类的-->

#### camera

相机光线生成

<!--两种camera和实现，以及控制光线生成的接口-->

#### ray_distribution

次生光线生成。

<!--
多种方式，有镜面反射/折射，有phone高光反射，有漫反射。
由统一的接口完成。
-->

#### serilization

序列化。

<!--
怎么将关键信息序列化和反序列化，保存所有信息且易扩展、空间占用小。
缺点是更新会破坏结构。
-->

## 效果演示

> 对演示图截图并分析光纤能量分布情况。通过调整几何、光源、相机以及材质等参数，记录场景中光线的分布变化情况，与理论分析相对应，总结规律。

<!--
展示：
1. 镜面折射之后漫反射，其中一部分碰到光源
1. 镜面反射后phone高光反射，碰到光源
-->

## 总结与展望

> 碰到的问题与解决方案
>
> 未解决的问题给出可能的解决方案

## 参考资料

[https://zh.wikipedia.org/wiki/%E4%B8%89%E7%BB%B4%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2](https://zh.wikipedia.org/wiki/三维计算机图形)